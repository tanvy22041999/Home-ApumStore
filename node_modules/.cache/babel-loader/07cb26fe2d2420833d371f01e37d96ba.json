{"ast":null,"code":"import _regeneratorRuntime from\"/Users/vyduong/Desktop/client/Home-ApumStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(handleGetList),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(handleGetDetail),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(handleReConfirm),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(handleCreate),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(handleConfirmOrder),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(handleUpdate),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(watchGetList),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(watchGetDetail),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(watchCreate),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(watchConfirmOrder),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(watchReConfirm),_marked12=/*#__PURE__*/_regeneratorRuntime.mark(watchUpdate),_marked13=/*#__PURE__*/_regeneratorRuntime.mark(rootSaga);import{takeEvery,fork,all,call,put,select}from\"redux-saga/effects\";import{get}from\"lodash\";import OrdersActions,{OrdersActionsTypes}from\"../actions/order\";import ProductsActions from\"../actions/products\";import{addOrder,sendConfirmEmail,confirmOrder,getDetailOrder,updateOrder,getAllOrder}from\"../apis/order\";/* Notification */import io from'socket.io-client';import NotificationActions from\"../actions/notification\";var socket=io('https://be-phonestore.herokuapp.com');/* Notification */function handleGetList(_ref){var payload,result,data;return _regeneratorRuntime.wrap(function handleGetList$(_context){while(1){switch(_context.prev=_context.next){case 0:payload=_ref.payload;_context.prev=1;_context.next=4;return call(getAllOrder,payload);case 4:result=_context.sent;data=get(result,\"data\");if(!(data.code!==200)){_context.next=8;break;}throw data;case 8:_context.next=10;return put(OrdersActions.onGetListSuccess(data.orders,data.total));case 10:_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);_context.next=16;return put(OrdersActions.onGetListError(_context.t0));case 16:case\"end\":return _context.stop();}}},_marked,null,[[1,12]]);}function handleGetDetail(_ref2){var id,result,data;return _regeneratorRuntime.wrap(function handleGetDetail$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:id=_ref2.id;_context2.prev=1;_context2.next=4;return call(getDetailOrder,id);case 4:result=_context2.sent;data=get(result,\"data\",{});if(!(data.code!==200)){_context2.next=8;break;}throw data;case 8:_context2.next=10;return put(OrdersActions.onGetDetailSuccess(data.order));case 10:_context2.next=16;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](1);_context2.next=16;return put(OrdersActions.onGetDetailError(_context2.t0));case 16:case\"end\":return _context2.stop();}}},_marked2,null,[[1,12]]);}function handleReConfirm(_ref3){var payload,result,data;return _regeneratorRuntime.wrap(function handleReConfirm$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:payload=_ref3.payload;_context3.prev=1;_context3.next=4;return call(sendConfirmEmail,payload);case 4:result=_context3.sent;data=get(result,\"data\",{});if(!(data.code!==200)){_context3.next=8;break;}throw data;case 8:if(!(data.message!==\"success\")){_context3.next=10;break;}throw data;case 10:_context3.next=12;return put(OrdersActions.onSendConfirmEmailSuccess(data));case 12:_context3.next=18;break;case 14:_context3.prev=14;_context3.t0=_context3[\"catch\"](1);_context3.next=18;return put(OrdersActions.onSendConfirmEmailError(_context3.t0));case 18:case\"end\":return _context3.stop();}}},_marked3,null,[[1,14]]);}/**\n *\n * create\n */function handleCreate(_ref4){var payload,state,result,data,email;return _regeneratorRuntime.wrap(function handleCreate$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:payload=_ref4.payload;_context4.prev=1;_context4.next=4;return select();case 4:state=_context4.sent;_context4.next=7;return call(addOrder,payload);case 7:result=_context4.sent;data=get(result,\"data\",{});if(!(data.code!==201)){_context4.next=11;break;}throw data;case 11:_context4.next=13;return put(OrdersActions.onCreateSuccess(data));case 13:if(!(payload.payment_method===\"paypal\")){_context4.next=17;break;}socket.emit('order',{email:data.order.email,order:data.order.id});_context4.next=17;return put(NotificationActions.onCreate({name:\"Đơn hàng mới được thanh toán qua Paypal\",image:data.order.user.image,link:data.order.id,type:0,user:null,content:\"\".concat(data.order.email,\" v\\u1EEBa thanh to\\xE1n v\\xE0 x\\xE1c nh\\u1EADn th\\xE0nh c\\xF4ng\")}));case 17:_context4.next=19;return put(ProductsActions.onClearCart({cart:state.cart,checkout:state.checkout}));case 19:_context4.next=21;return put(ProductsActions.onClearCheckout());case 21:_context4.next=23;return call(sendConfirmEmail,data.order.id);case 23:email=_context4.sent;_context4.next=26;return put(OrdersActions.onSendConfirmEmailSuccess(email.data));case 26:_context4.next=32;break;case 28:_context4.prev=28;_context4.t0=_context4[\"catch\"](1);_context4.next=32;return put(OrdersActions.onCreateError(_context4.t0));case 32:case\"end\":return _context4.stop();}}},_marked4,null,[[1,28]]);}function handleConfirmOrder(_ref5){var payload,result,data;return _regeneratorRuntime.wrap(function handleConfirmOrder$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:payload=_ref5.payload;_context5.prev=1;_context5.next=4;return call(confirmOrder,payload);case 4:result=_context5.sent;data=get(result,\"data\",{});if(!(data.code!==200)){_context5.next=8;break;}throw data;case 8:_context5.next=10;return put(OrdersActions.onConfirmOrderSuccess(data));case 10:/* Notification */socket.emit('order',{email:data.order.email,order:data.order.id});_context5.next=13;return put(NotificationActions.onCreate({name:\"Đơn hàng mới được xác nhận\",image:data.order.user.image,link:data.order.id,type:0,content:\"\".concat(data.order.email,\" v\\u1EEBa x\\xE1c nh\\u1EADn \\u0111\\u1EB7t h\\xE0ng th\\xE0nh c\\xF4ng\")}));case 13:_context5.next=19;break;case 15:_context5.prev=15;_context5.t0=_context5[\"catch\"](1);_context5.next=19;return put(OrdersActions.onConfirmOrderError(_context5.t0));case 19:case\"end\":return _context5.stop();}}},_marked5,null,[[1,15]]);}/**\n *\n * update\n */ /**\n *\n * delete\n */function handleUpdate(_ref6){var payload,result,data,detailResult;return _regeneratorRuntime.wrap(function handleUpdate$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref6.payload;_context6.prev=1;_context6.next=4;return call(updateOrder,payload.id,payload.data);case 4:result=_context6.sent;data=get(result,\"data\",{});if(!(data.code!==200)){_context6.next=8;break;}throw data;case 8:_context6.next=10;return call(getDetailOrder,payload.id);case 10:detailResult=_context6.sent;_context6.next=13;return put(OrdersActions.onUpdateSuccess(get(detailResult,\"data\")));case 13:_context6.next=15;return put(OrdersActions.onGetList(payload.params));case 15:_context6.next=21;break;case 17:_context6.prev=17;_context6.t0=_context6[\"catch\"](1);_context6.next=21;return put(OrdersActions.onUpdateError(_context6.t0));case 21:case\"end\":return _context6.stop();}}},_marked6,null,[[1,17]]);}/**\n *\n */export function watchGetList(){return _regeneratorRuntime.wrap(function watchGetList$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return takeEvery(OrdersActionsTypes.GET_LIST,handleGetList);case 2:case\"end\":return _context7.stop();}}},_marked7);}export function watchGetDetail(){return _regeneratorRuntime.wrap(function watchGetDetail$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return takeEvery(OrdersActionsTypes.GET_DETAIL,handleGetDetail);case 2:case\"end\":return _context8.stop();}}},_marked8);}export function watchCreate(){return _regeneratorRuntime.wrap(function watchCreate$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return takeEvery(OrdersActionsTypes.CREATE,handleCreate);case 2:case\"end\":return _context9.stop();}}},_marked9);}export function watchConfirmOrder(){return _regeneratorRuntime.wrap(function watchConfirmOrder$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return takeEvery(OrdersActionsTypes.CONFIRM_ORDER,handleConfirmOrder);case 2:case\"end\":return _context10.stop();}}},_marked10);}export function watchReConfirm(){return _regeneratorRuntime.wrap(function watchReConfirm$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return takeEvery(OrdersActionsTypes.SEND_CONFIRM_EMAIL,handleReConfirm);case 2:case\"end\":return _context11.stop();}}},_marked11);}export function watchUpdate(){return _regeneratorRuntime.wrap(function watchUpdate$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return takeEvery(OrdersActionsTypes.UPDATE,handleUpdate);case 2:case\"end\":return _context12.stop();}}},_marked12);}export default function rootSaga(){return _regeneratorRuntime.wrap(function rootSaga$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return all([fork(watchGetList),fork(watchGetDetail),fork(watchCreate),fork(watchConfirmOrder),fork(watchReConfirm),fork(watchUpdate)]);case 2:case\"end\":return _context13.stop();}}},_marked13);}","map":{"version":3,"sources":["/Users/vyduong/Desktop/client/Home-ApumStore/src/redux/sagas/order.js"],"names":["handleGetList","handleGetDetail","handleReConfirm","handleCreate","handleConfirmOrder","handleUpdate","watchGetList","watchGetDetail","watchCreate","watchConfirmOrder","watchReConfirm","watchUpdate","rootSaga","takeEvery","fork","all","call","put","select","get","OrdersActions","OrdersActionsTypes","ProductsActions","addOrder","sendConfirmEmail","confirmOrder","getDetailOrder","updateOrder","getAllOrder","io","NotificationActions","socket","payload","result","data","code","onGetListSuccess","orders","total","onGetListError","id","onGetDetailSuccess","order","onGetDetailError","message","onSendConfirmEmailSuccess","onSendConfirmEmailError","state","onCreateSuccess","payment_method","emit","email","onCreate","name","image","user","link","type","content","onClearCart","cart","checkout","onClearCheckout","onCreateError","onConfirmOrderSuccess","onConfirmOrderError","detailResult","onUpdateSuccess","onGetList","params","onUpdateError","GET_LIST","GET_DETAIL","CREATE","CONFIRM_ORDER","SEND_CONFIRM_EMAIL","UPDATE"],"mappings":"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","sourcesContent":["import { takeEvery, fork, all, call, put, select } from \"redux-saga/effects\";\nimport { get } from \"lodash\";\nimport OrdersActions, { OrdersActionsTypes } from \"../actions/order\";\nimport ProductsActions from \"../actions/products\";\nimport { addOrder, sendConfirmEmail, confirmOrder, getDetailOrder, updateOrder, getAllOrder } from \"../apis/order\";\n/* Notification */\nimport io from 'socket.io-client';\nimport NotificationActions from \"../actions/notification\";\nconst socket = io('https://be-phonestore.herokuapp.com');\n/* Notification */\n\nfunction* handleGetList({payload}) {\n  try {\n    const result = yield call(getAllOrder, payload);\n    const data = get(result, \"data\")\n    if (data.code !== 200) throw data;\n    yield put(OrdersActions.onGetListSuccess(data.orders, data.total));\n  } catch (error) {\n    yield put(OrdersActions.onGetListError(error));\n  }\n}\n\nfunction* handleGetDetail({id}) {\n  try {\n    const result = yield call(getDetailOrder, id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    yield put(OrdersActions.onGetDetailSuccess(data.order));\n  } catch (error) {\n    yield put(OrdersActions.onGetDetailError(error));\n  }\n}\n\nfunction* handleReConfirm({ payload }) {\n  try {\n    const result = yield call(sendConfirmEmail, payload);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    if (data.message !== \"success\") throw data;\n    yield put(OrdersActions.onSendConfirmEmailSuccess(data));\n  } catch (error) {\n    yield put(OrdersActions.onSendConfirmEmailError(error));\n  }\n}\n\n/**\n *\n * create\n */\nfunction* handleCreate({ payload }) {\n  try {\n    const state = yield select()\n    const result = yield call(addOrder, payload);\n    const data = get(result, \"data\", {});\n    if (data.code !== 201) throw data;\n    yield put(OrdersActions.onCreateSuccess(data));\n    /* Notification */\n    if(payload.payment_method === \"paypal\"){\n      socket.emit('order', { \n        email: data.order.email, \n        order: data.order.id \n      });\n      yield put(NotificationActions.onCreate({\n        name : \"Đơn hàng mới được thanh toán qua Paypal\",\n        image : data.order.user.image,\n        link: data.order.id,\n        type: 0,\n        user: null,\n        content :  `${data.order.email} vừa thanh toán và xác nhận thành công`\n      }))\n    }\n    /* Notification */\n    yield put(ProductsActions.onClearCart({cart: state.cart, checkout: state.checkout}))\n    yield put(ProductsActions.onClearCheckout())\n    const email = yield call(sendConfirmEmail, data.order.id);\n    yield put(OrdersActions.onSendConfirmEmailSuccess(email.data));\n  } catch (error) {\n    yield put(OrdersActions.onCreateError(error));\n  }\n}\n\nfunction* handleConfirmOrder({ payload}) {\n  try {\n    const result = yield call(confirmOrder, payload);\n    const data = get(result, \"data\", {});  \n    if (data.code !== 200) throw data;\n    yield put(OrdersActions.onConfirmOrderSuccess(data));\n    /* Notification */\n    socket.emit('order', { email: data.order.email, order: data.order.id });\n    yield put(NotificationActions.onCreate({\n      name : \"Đơn hàng mới được xác nhận\",\n      image : data.order.user.image,\n      link: data.order.id,\n      type: 0,\n      content :  `${data.order.email} vừa xác nhận đặt hàng thành công`\n    }))\n    /* Notification */\n  } catch (error) {\n    yield put(OrdersActions.onConfirmOrderError(error));\n  }\n}\n\n/**\n *\n * update\n */\n/**\n *\n * delete\n */\nfunction* handleUpdate({ payload }) {\n  try {\n    const result = yield call(updateOrder, payload.id, payload.data);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    const detailResult = yield call(getDetailOrder, payload.id);\n    yield put(OrdersActions.onUpdateSuccess(get(detailResult, \"data\")));\n    yield put(OrdersActions.onGetList(payload.params))\n  } catch (error) {\n    yield put(OrdersActions.onUpdateError(error));\n  }\n}\n\n/**\n *\n */\nexport function* watchGetList() {\n  yield takeEvery(OrdersActionsTypes.GET_LIST, handleGetList);\n}\nexport function* watchGetDetail() {\n  yield takeEvery(OrdersActionsTypes.GET_DETAIL, handleGetDetail);\n}\nexport function* watchCreate() {\n  yield takeEvery(OrdersActionsTypes.CREATE, handleCreate);\n}\nexport function* watchConfirmOrder() {\n  yield takeEvery(OrdersActionsTypes.CONFIRM_ORDER, handleConfirmOrder);\n}\nexport function* watchReConfirm() {\n  yield takeEvery(OrdersActionsTypes.SEND_CONFIRM_EMAIL, handleReConfirm);\n}\nexport function* watchUpdate() {\n  yield takeEvery(OrdersActionsTypes.UPDATE, handleUpdate);\n}\n\nexport default function* rootSaga() {\n  yield all([\n    fork(watchGetList),\n    fork(watchGetDetail),\n    fork(watchCreate),\n    fork(watchConfirmOrder),\n    fork(watchReConfirm),\n    fork(watchUpdate),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}