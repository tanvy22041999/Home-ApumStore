{"ast":null,"code":"import { takeEvery, fork, all, call, put } from \"redux-saga/effects\";\nimport { get } from \"lodash\";\nimport InstallmentActions, { InstallmentActionTypes } from \"../actions/installment\";\nimport { getAllInstallments, getDetailInstallment, addInstallment, updateInstallment, deleteInstallment } from \"../apis/installment\";\nimport { getUser } from \"../apis/user\";\n/* Notification */\n\nimport io from \"socket.io-client\";\nimport NotificationActions from \"../actions/notification\";\nconst socket = io(\"https://be-phonestore.herokuapp.com\");\n/* Notification */\n\nfunction* handleGetList({\n  payload\n}) {\n  try {\n    const result = yield call(getAllInstallments, payload);\n    const data = get(result, \"data\");\n    if (data.code !== 200) throw data;\n    yield put(InstallmentActions.onGetListSuccess(data.installments, data.total));\n  } catch (error) {\n    yield put(InstallmentActions.onGetListError(error));\n  }\n}\n\nfunction* handleGetDetail({\n  filters,\n  id\n}) {\n  try {\n    const result = yield call(getDetailInstallment, id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    yield put(InstallmentActions.onGetDetailSuccess(data.installment));\n  } catch (error) {\n    yield put(InstallmentActions.onGetDetailError(error));\n  }\n}\n/**\n *\n * create\n */\n\n\nfunction* handleCreate({\n  payload\n}) {\n  try {\n    const result = yield call(addInstallment, payload.params);\n    const data = get(result, \"data\", {});\n    if (data.code !== 201) throw data;\n    yield put(InstallmentActions.onCreateSuccess(data.installment));\n    yield put(InstallmentActions.onGetList());\n    const userRes = yield call(getUser, payload.params.user);\n    const instRes = yield call(getDetailInstallment, data.installment._id);\n    /* Notification */\n\n    socket.emit(\"installment\", {\n      email: userRes.data.user.email,\n      installment: data.installment._id\n    });\n    yield put(NotificationActions.onCreate({\n      name: \"Yêu cầu trả góp mới cần duyệt\",\n      image: instRes.data.installment.product._id.bigimage._id,\n      link: data.installment._id,\n      type: 2,\n      content: `${userRes.data.user.email} vừa gửi yêu cầu trả góp cho sản phẩm`\n    }));\n    /* Notification */\n  } catch (error) {\n    yield put(InstallmentActions.onCreateError(error));\n  }\n}\n/**\n *\n * update\n */\n\n\nfunction* handleUpdate({\n  payload\n}) {\n  try {\n    const result = yield call(updateInstallment, payload.data, payload.id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    const detailResult = yield call(getDetailInstallment, payload.id);\n    yield put(InstallmentActions.onUpdateSuccess(get(detailResult, \"data\")));\n    yield put(InstallmentActions.onGetList());\n    const userRes = yield call(getUser, data.installment.user); // Thanh toán thành công thì báo về cho admin\n\n    if (payload.data.money) {\n      socket.emit(\"installmentMoney\", {\n        email: userRes.data.user.email,\n        installment: data.installment._id\n      });\n      yield put(NotificationActions.onCreate({\n        type: 2,\n        user: null,\n        link: data.installment._id,\n        name: `Phiếu trả góp ${data.installment._id} vừa được thanh toán`,\n        image: detailResult.data.installment.product._id.bigimage._id,\n        content: `${data.installment._id} đã được thanh toán tại cửa hàng với số tiền là ${payload.data.money} VND`\n      }));\n    }\n  } catch (error) {\n    yield put(InstallmentActions.onUpdateError(error));\n  }\n}\n/**\n *\n * delete\n */\n\n\nfunction* handleDelete({\n  id\n}) {\n  try {\n    const result = yield call(deleteInstallment, id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    yield put(InstallmentActions.onDeleteSuccess(data));\n    yield put(InstallmentActions.onGetList());\n  } catch (error) {\n    yield put(InstallmentActions.onDeleteError(error));\n  }\n}\n\nexport function* watchGetList() {\n  yield takeEvery(InstallmentActionTypes.GET_LIST, handleGetList);\n}\nexport function* watchGetDetail() {\n  yield takeEvery(InstallmentActionTypes.GET_DETAIL, handleGetDetail);\n}\nexport function* watchCreate() {\n  yield takeEvery(InstallmentActionTypes.CREATE, handleCreate);\n}\nexport function* watchUpdate() {\n  yield takeEvery(InstallmentActionTypes.UPDATE, handleUpdate);\n}\nexport function* watchDelete() {\n  yield takeEvery(InstallmentActionTypes.DELETE, handleDelete);\n}\nexport default function* rootSaga() {\n  yield all([fork(watchGetList), fork(watchGetDetail), fork(watchCreate), fork(watchUpdate), fork(watchDelete)]);\n}","map":{"version":3,"sources":["/Users/vyduong/Desktop/DOChoi_FE/WebBanDienThoai-master 2/FE_WebBanDienThoai/src/redux/sagas/installment.js"],"names":["takeEvery","fork","all","call","put","get","InstallmentActions","InstallmentActionTypes","getAllInstallments","getDetailInstallment","addInstallment","updateInstallment","deleteInstallment","getUser","io","NotificationActions","socket","handleGetList","payload","result","data","code","onGetListSuccess","installments","total","error","onGetListError","handleGetDetail","filters","id","onGetDetailSuccess","installment","onGetDetailError","handleCreate","params","onCreateSuccess","onGetList","userRes","user","instRes","_id","emit","email","onCreate","name","image","product","bigimage","link","type","content","onCreateError","handleUpdate","detailResult","onUpdateSuccess","money","onUpdateError","handleDelete","onDeleteSuccess","onDeleteError","watchGetList","GET_LIST","watchGetDetail","GET_DETAIL","watchCreate","CREATE","watchUpdate","UPDATE","watchDelete","DELETE","rootSaga"],"mappings":"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","sourcesContent":["import { takeEvery, fork, all, call, put } from \"redux-saga/effects\";\nimport { get } from \"lodash\";\nimport InstallmentActions, {\n  InstallmentActionTypes,\n} from \"../actions/installment\";\nimport {\n  getAllInstallments,\n  getDetailInstallment,\n  addInstallment,\n  updateInstallment,\n  deleteInstallment,\n} from \"../apis/installment\";\nimport { getUser } from \"../apis/user\";\n/* Notification */\nimport io from \"socket.io-client\";\nimport NotificationActions from \"../actions/notification\";\nconst socket = io(\"https://be-phonestore.herokuapp.com\");\n/* Notification */\n\nfunction* handleGetList({ payload }) {\n  try {\n    const result = yield call(getAllInstallments, payload);\n    const data = get(result, \"data\");\n    if (data.code !== 200) throw data;\n    yield put(\n      InstallmentActions.onGetListSuccess(data.installments, data.total)\n    );\n  } catch (error) {\n    yield put(InstallmentActions.onGetListError(error));\n  }\n}\n\nfunction* handleGetDetail({ filters, id }) {\n  try {\n    const result = yield call(getDetailInstallment, id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    yield put(InstallmentActions.onGetDetailSuccess(data.installment));\n  } catch (error) {\n    yield put(InstallmentActions.onGetDetailError(error));\n  }\n}\n\n/**\n *\n * create\n */\nfunction* handleCreate({ payload }) {\n  try {\n    const result = yield call(addInstallment, payload.params);\n    const data = get(result, \"data\", {});\n    if (data.code !== 201) throw data;\n    yield put(InstallmentActions.onCreateSuccess(data.installment));\n    yield put(InstallmentActions.onGetList());\n    const userRes = yield call(getUser, payload.params.user);\n    const instRes = yield call(getDetailInstallment, data.installment._id);\n    /* Notification */\n    socket.emit(\"installment\", {\n      email: userRes.data.user.email,\n      installment: data.installment._id,\n    });\n    yield put(\n      NotificationActions.onCreate({\n        name: \"Yêu cầu trả góp mới cần duyệt\",\n        image: instRes.data.installment.product._id.bigimage._id,\n        link: data.installment._id,\n        type: 2,\n        content: `${userRes.data.user.email} vừa gửi yêu cầu trả góp cho sản phẩm`,\n      })\n    );\n    /* Notification */\n  } catch (error) {\n    yield put(InstallmentActions.onCreateError(error));\n  }\n}\n\n/**\n *\n * update\n */\nfunction* handleUpdate({ payload }) {\n  try {\n    const result = yield call(updateInstallment, payload.data, payload.id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    const detailResult = yield call(getDetailInstallment, payload.id);\n    yield put(InstallmentActions.onUpdateSuccess(get(detailResult, \"data\")));\n    yield put(InstallmentActions.onGetList());\n    const userRes = yield call(getUser, data.installment.user);\n    // Thanh toán thành công thì báo về cho admin\n    if (payload.data.money) {\n      socket.emit(\"installmentMoney\", {\n        email: userRes.data.user.email,\n        installment: data.installment._id,\n      });\n      yield put(\n        NotificationActions.onCreate({\n          type: 2,\n          user: null,\n          link: data.installment._id,\n          name: `Phiếu trả góp ${data.installment._id} vừa được thanh toán`,\n          image: detailResult.data.installment.product._id.bigimage._id,\n          content: `${data.installment._id} đã được thanh toán tại cửa hàng với số tiền là ${payload.data.money} VND`,\n        })\n      );\n    }\n  } catch (error) {\n    yield put(InstallmentActions.onUpdateError(error));\n  }\n}\n\n/**\n *\n * delete\n */\nfunction* handleDelete({ id }) {\n  try {\n    const result = yield call(deleteInstallment, id);\n    const data = get(result, \"data\", {});\n    if (data.code !== 200) throw data;\n    yield put(InstallmentActions.onDeleteSuccess(data));\n    yield put(InstallmentActions.onGetList());\n  } catch (error) {\n    yield put(InstallmentActions.onDeleteError(error));\n  }\n}\n\nexport function* watchGetList() {\n  yield takeEvery(InstallmentActionTypes.GET_LIST, handleGetList);\n}\nexport function* watchGetDetail() {\n  yield takeEvery(InstallmentActionTypes.GET_DETAIL, handleGetDetail);\n}\nexport function* watchCreate() {\n  yield takeEvery(InstallmentActionTypes.CREATE, handleCreate);\n}\nexport function* watchUpdate() {\n  yield takeEvery(InstallmentActionTypes.UPDATE, handleUpdate);\n}\nexport function* watchDelete() {\n  yield takeEvery(InstallmentActionTypes.DELETE, handleDelete);\n}\n\nexport default function* rootSaga() {\n  yield all([\n    fork(watchGetList),\n    fork(watchGetDetail),\n    fork(watchCreate),\n    fork(watchUpdate),\n    fork(watchDelete),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}